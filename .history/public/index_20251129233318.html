<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Accesorios Frices - Auth</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div class="auth-wrapper">

  <!-- LOGO -->
  <img src="logo.png" class="logo-frices" alt="Accesorios Frices">

  <!-- MENSAJE GLOBAL -->
  <div id="message" class="auth-msg-global"></div>

  <!-- TARJETA LOGIN / REGISTER -->
  <div id="auth-card" class="auth-card">
    <div class="auth-tabs">
      <button id="tab-login" class="tab active" onclick="showLogin()">Login</button>
      <button id="tab-register" class="tab" onclick="showRegister()">Register</button>
    </div>

    <!-- LOGIN -->
    <div id="login-form" class="form-panel active">
      <h2 class="auth-title">Iniciar Sesi칩n</h2>

      <input id="log-email" class="auth-input" placeholder="Correo" type="email" />
      <input id="log-pass" class="auth-input" placeholder="Contrase침a" type="password" />

      <button class="auth-button" onclick="login()">Login</button>
      <div id="msg-login" class="auth-msg"></div>

      <button class="link-button" type="button">쯆lvidaste tu contrase침a?</button>

      <p class="switch">
        쮸칰n no tienes cuenta?
        <button type="button" class="link-button" onclick="showRegister()">Crear cuenta</button>
      </p>
    </div>

    <!-- REGISTER -->
    <div id="register-form" class="form-panel">
      <h2 class="auth-title">Crear Cuenta</h2>

      <input id="reg-nombre" class="auth-input" placeholder="Nombre completo" />
      <input id="reg-email" class="auth-input" placeholder="Correo" type="email" />
      <input id="reg-pass" class="auth-input" placeholder="Contrase침a" type="password" />

      <button class="auth-button" onclick="registrar()">Registrarse</button>
      <div id="msg-registro" class="auth-msg"></div>

      <p class="switch">
        쯏a tienes una cuenta?
        <button type="button" class="link-button" onclick="showLogin()">Iniciar sesi칩n</button>
      </p>
    </div>
  </div>

  <!-- SECCI칍N BIENVENIDA -->
  <div id="welcomeSection" class="auth-card card-welcome" style="display:none;">
    <div class="welcome-icon">游눐</div>
    <h2 class="welcome-title">Bienvenida a Accesorios Frices</h2>
    <p id="welcomeText" class="welcome-text"></p>
    <p class="welcome-subtext">
      Tu sesi칩n se ha iniciado correctamente.  
      Pr칩ximamente podr치s ver tus pedidos, direcciones y favoritos desde aqu칤.
    </p>
    <button id="logoutBtn" class="auth-button secondary">Cerrar sesi칩n</button>
  </div>

</div>

<script>
  const API_URL = "http://localhost:3000/api";
  const $ = (id) => document.getElementById(id);

  function clearMessages() {
    $("message").innerText = "";
    $("msg-login").innerText = "";
    $("msg-registro").innerText = "";
  }

  function showLogin() {
    clearMessages();

    $("login-form").classList.add("active");
    $("register-form").classList.remove("active");

    $("tab-login").classList.add("active");
    $("tab-register").classList.remove("active");
  }

  function showRegister() {
    clearMessages();

    $("login-form").classList.remove("active");
    $("register-form").classList.add("active");

    $("tab-login").classList.remove("active");
    $("tab-register").classList.add("active");
  }

  // ============ REGISTRO ============
  async function registrar() {
    clearMessages();

    const nombre = $("reg-nombre").value.trim();
    const email  = $("reg-email").value.trim();
    const pass   = $("reg-pass").value.trim();

    if (!nombre || !email || !pass) {
      $("msg-registro").innerText = "Completa todos los campos.";
      return;
    }

    try {
      const res = await fetch(`${API_URL}/auth/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nombre, email, password: pass }),
      });

      const data = await res.json();

      if (!res.ok) {
        $("msg-registro").innerText = data.message || "Error al registrar";
        return;
      }

      $("msg-registro").innerText = "Registro exitoso 游꿀 Ahora inicia sesi칩n.";
      // Cambiar autom치ticamente a Login y rellenar correo
      showLogin();
      $("log-email").value = email;

    } catch (err) {
      console.error(err);
      $("message").innerText = "Error de red al registrar.";
    }
  }

  // ============ LOGIN ============
  async function login() {
    clearMessages();

    const email = $("log-email").value.trim();
    const pass  = $("log-pass").value.trim();

    if (!email || !pass) {
      $("msg-login").innerText = "Ingresa correo y contrase침a.";
      return;
    }

    try {
      const res = await fetch(`${API_URL}/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password: pass }),
      });

      const data = await res.json();

      if (!res.ok) {
        $("msg-login").innerText = data.message || "Credenciales inv치lidas";
        return;
      }

      // Guardar token si viene
      if (data.token) {
        localStorage.setItem("frices_token", data.token);
      }

      // Mostrar bienvenida
      const userName = data.user?.nombre || email;
      $("welcomeText").innerText =
        `Hola, ${userName}. Gracias por confiar en Accesorios Frices.`;

      $("auth-card").style.display = "none";
      $("welcomeSection").style.display = "block";

    } catch (err) {
      console.error(err);
      $("message").innerText = "Error de red al iniciar sesi칩n.";
    }
  }

  // ============ LOGOUT ============
  const logoutBtn = document.getElementById("logoutBtn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("frices_token");
      $("welcomeSection").style.display = "none";
      $("auth-card").style.display = "block";
      showLogin();
    });
  }
</script>

</body>
</html>
